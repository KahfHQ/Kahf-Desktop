var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target, mod));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var Linkify_exports = {};
__export(Linkify_exports, {
  Linkify: () => Linkify
});
module.exports = __toCommonJS(Linkify_exports);
var import_react = __toESM(require("react"));
var import_linkify_it = __toESM(require("linkify-it"));
var import_LinkPreview = require("../../types/LinkPreview");
var import_emoji = require("../../util/emoji");
var import_missingCaseError = require("../../util/missingCaseError");
const linkify = (0, import_linkify_it.default)().tlds([
  "ac",
  "ad",
  "ae",
  "aero",
  "af",
  "ag",
  "ai",
  "al",
  "am",
  "an",
  "ao",
  "aq",
  "ar",
  "arpa",
  "as",
  "asia",
  "at",
  "au",
  "aw",
  "ax",
  "az",
  "ba",
  "bb",
  "bd",
  "be",
  "bf",
  "bg",
  "bh",
  "bi",
  "biz",
  "bj",
  "bl",
  "bm",
  "bn",
  "bo",
  "bq",
  "br",
  "bs",
  "bt",
  "bv",
  "bw",
  "by",
  "bz",
  "ca",
  "cat",
  "cc",
  "cd",
  "cf",
  "cg",
  "ch",
  "ci",
  "ck",
  "cl",
  "cm",
  "cn",
  "co",
  "com",
  "coop",
  "cr",
  "cu",
  "cv",
  "cw",
  "cx",
  "cy",
  "cz",
  "de",
  "dj",
  "dk",
  "dm",
  "do",
  "dz",
  "ec",
  "edu",
  "ee",
  "eg",
  "er",
  "es",
  "et",
  "eu",
  "fi",
  "fj",
  "fk",
  "fm",
  "fo",
  "fr",
  "ga",
  "gb",
  "gd",
  "ge",
  "gf",
  "gg",
  "gh",
  "gi",
  "gl",
  "gm",
  "gn",
  "gov",
  "gp",
  "gq",
  "gr",
  "gs",
  "gt",
  "gu",
  "gw",
  "gy",
  "hk",
  "hm",
  "hn",
  "hr",
  "ht",
  "hu",
  "id",
  "ie",
  "il",
  "im",
  "in",
  "info",
  "int",
  "io",
  "iq",
  "ir",
  "is",
  "it",
  "je",
  "jm",
  "jo",
  "jobs",
  "jp",
  "ke",
  "kg",
  "kh",
  "ki",
  "km",
  "kn",
  "kp",
  "kr",
  "kw",
  "ky",
  "kz",
  "la",
  "lb",
  "lc",
  "li",
  "lk",
  "lr",
  "ls",
  "lt",
  "lu",
  "lv",
  "ly",
  "ma",
  "mc",
  "md",
  "me",
  "mf",
  "mg",
  "mh",
  "mil",
  "mk",
  "ml",
  "mm",
  "mn",
  "mo",
  "mobi",
  "mp",
  "mq",
  "mr",
  "ms",
  "mt",
  "mu",
  "museum",
  "mv",
  "mw",
  "mx",
  "my",
  "mz",
  "na",
  "name",
  "nc",
  "ne",
  "net",
  "nf",
  "ng",
  "ni",
  "nl",
  "no",
  "np",
  "nr",
  "nu",
  "nz",
  "om",
  "org",
  "pa",
  "pe",
  "pf",
  "pg",
  "ph",
  "pk",
  "pl",
  "pm",
  "pn",
  "pr",
  "pro",
  "ps",
  "pt",
  "pw",
  "py",
  "qa",
  "re",
  "ro",
  "rs",
  "ru",
  "rw",
  "sa",
  "sb",
  "sc",
  "sd",
  "se",
  "sg",
  "sh",
  "si",
  "sj",
  "sk",
  "sl",
  "sm",
  "sn",
  "so",
  "sr",
  "st",
  "su",
  "sv",
  "sx",
  "sy",
  "sz",
  "tc",
  "td",
  "tel",
  "tf",
  "tg",
  "th",
  "tj",
  "tk",
  "tl",
  "tm",
  "tn",
  "to",
  "tp",
  "tr",
  "travel",
  "tt",
  "tv",
  "tw",
  "tz",
  "ua",
  "ug",
  "uk",
  "um",
  "us",
  "uy",
  "uz",
  "va",
  "vc",
  "ve",
  "vg",
  "vi",
  "vn",
  "vu",
  "wf",
  "ws",
  "\u4E2D\u56FD",
  "\u4E2D\u570B",
  "\u0DBD\u0D82\u0D9A\u0DCF",
  "\u9999\u6E2F",
  "\u53F0\u6E7E",
  "\u53F0\u7063",
  "\u0627\u0645\u0627\u0631\u0627\u062A",
  "\u0627\u0644\u0627\u0631\u062F\u0646",
  "\u0627\u0644\u0633\u0639\u0648\u062F\u064A\u0629",
  "\u0E44\u0E17\u0E22",
  "\u0440\u0444",
  "\u062A\u0648\u0646\u0633",
  "\u0645\u0635\u0631",
  "\u0642\u0637\u0631",
  "\u0B87\u0BB2\u0B99\u0BCD\u0B95\u0BC8",
  "\u0641\u0644\u0633\u0637\u064A\u0646",
  "ye",
  "yt",
  "za",
  "zm",
  "zw"
]);
const SUPPORTED_PROTOCOLS = /^(http|https):/i;
class Linkify extends import_react.default.Component {
  render() {
    const { text, renderNonLink } = this.props;
    if (!(0, import_LinkPreview.shouldLinkifyMessage)(text)) {
      return text;
    }
    if (!renderNonLink) {
      return null;
    }
    const chunkData = (0, import_emoji.splitByEmoji)(text).map(({ type, value: chunk }) => {
      if (type === "text") {
        return { chunk, matchData: linkify.match(chunk) || [] };
      }
      if (type === "emoji") {
        return { chunk, matchData: [] };
      }
      throw (0, import_missingCaseError.missingCaseError)(type);
    });
    const results = [];
    let count = 1;
    chunkData.forEach(({ chunk, matchData }) => {
      if (matchData.length === 0) {
        count += 1;
        results.push(renderNonLink({ text: chunk, key: count }));
        return;
      }
      let chunkLastIndex = 0;
      matchData.forEach((match) => {
        if (chunkLastIndex < match.index) {
          const textWithNoLink = chunk.slice(chunkLastIndex, match.index);
          count += 1;
          results.push(renderNonLink({ text: textWithNoLink, key: count }));
        }
        const { url, text: originalText } = match;
        count += 1;
        if (SUPPORTED_PROTOCOLS.test(url) && !(0, import_LinkPreview.isLinkSneaky)(url)) {
          results.push(/* @__PURE__ */ import_react.default.createElement("a", {
            key: count,
            href: url
          }, originalText));
        } else {
          results.push(renderNonLink({ text: originalText, key: count }));
        }
        chunkLastIndex = match.lastIndex;
      });
      if (chunkLastIndex < chunk.length) {
        count += 1;
        results.push(renderNonLink({
          text: chunk.slice(chunkLastIndex),
          key: count
        }));
      }
    });
    return results;
  }
}
Linkify.defaultProps = {
  renderNonLink: ({ text }) => text
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  Linkify
});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiTGlua2lmeS50c3giXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8vIENvcHlyaWdodCAyMDE4LTIwMjEgU2lnbmFsIE1lc3NlbmdlciwgTExDXG4vLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQUdQTC0zLjAtb25seVxuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgTGlua2lmeUl0IGZyb20gJ2xpbmtpZnktaXQnO1xuXG5pbXBvcnQgdHlwZSB7IFJlbmRlclRleHRDYWxsYmFja1R5cGUgfSBmcm9tICcuLi8uLi90eXBlcy9VdGlsJztcbmltcG9ydCB7IGlzTGlua1NuZWFreSwgc2hvdWxkTGlua2lmeU1lc3NhZ2UgfSBmcm9tICcuLi8uLi90eXBlcy9MaW5rUHJldmlldyc7XG5pbXBvcnQgeyBzcGxpdEJ5RW1vamkgfSBmcm9tICcuLi8uLi91dGlsL2Vtb2ppJztcbmltcG9ydCB7IG1pc3NpbmdDYXNlRXJyb3IgfSBmcm9tICcuLi8uLi91dGlsL21pc3NpbmdDYXNlRXJyb3InO1xuXG5jb25zdCBsaW5raWZ5ID0gTGlua2lmeUl0KClcbiAgLy8gVGhpcyBpcyBhbGwgVExEcyBpbiBwbGFjZSBpbiAyMDEwLCBhY2NvcmRpbmcgdG8gW0lBTkEncyByb290IHpvbmUgZGF0YWJhc2VdWzBdXG4gIC8vICAgZXhjZXB0IGZvciB0aG9zZSBkb21haW5zIG1hcmtlZCBhcyBbYSB0ZXN0IGRvbWFpbl1bMV0uXG4gIC8vXG4gIC8vIE5vdGUgdGhhdCB0aGlzIG9ubHkgYXBwbGllcyB0byBcImZ1enp5XCIgbWF0Y2hlcyAoYGV4YW1wbGUuY29tYCksIG5vdCBtYXRjaGVzIHdpdGhcbiAgLy8gICBwcm90b2NvbHMgKGBodHRwczovL2V4YW1wbGUuY29tYCkuIFNlZSBbdGhpcyBHaXRIdWIgY29tbWVudF1bMl0gZm9yIG1vcmUuXG4gIC8vXG4gIC8vIFswXTogaHR0cHM6Ly93d3cuaWFuYS5vcmcvZG9tYWlucy9yb290L2RiXG4gIC8vIFsxXTogaHR0cHM6Ly93d3cuaWFuYS5vcmcvZG9tYWlucy9yZXNlcnZlZFxuICAvLyBbMl06IGh0dHBzOi8vZ2l0aHViLmNvbS9zaWduYWxhcHAvU2lnbmFsLURlc2t0b3AvaXNzdWVzLzQ1MzgjaXNzdWVjb21tZW50LTc0ODM2ODU5MFxuICAudGxkcyhbXG4gICAgJ2FjJyxcbiAgICAnYWQnLFxuICAgICdhZScsXG4gICAgJ2Flcm8nLFxuICAgICdhZicsXG4gICAgJ2FnJyxcbiAgICAnYWknLFxuICAgICdhbCcsXG4gICAgJ2FtJyxcbiAgICAnYW4nLFxuICAgICdhbycsXG4gICAgJ2FxJyxcbiAgICAnYXInLFxuICAgICdhcnBhJyxcbiAgICAnYXMnLFxuICAgICdhc2lhJyxcbiAgICAnYXQnLFxuICAgICdhdScsXG4gICAgJ2F3JyxcbiAgICAnYXgnLFxuICAgICdheicsXG4gICAgJ2JhJyxcbiAgICAnYmInLFxuICAgICdiZCcsXG4gICAgJ2JlJyxcbiAgICAnYmYnLFxuICAgICdiZycsXG4gICAgJ2JoJyxcbiAgICAnYmknLFxuICAgICdiaXonLFxuICAgICdiaicsXG4gICAgJ2JsJyxcbiAgICAnYm0nLFxuICAgICdibicsXG4gICAgJ2JvJyxcbiAgICAnYnEnLFxuICAgICdicicsXG4gICAgJ2JzJyxcbiAgICAnYnQnLFxuICAgICdidicsXG4gICAgJ2J3JyxcbiAgICAnYnknLFxuICAgICdieicsXG4gICAgJ2NhJyxcbiAgICAnY2F0JyxcbiAgICAnY2MnLFxuICAgICdjZCcsXG4gICAgJ2NmJyxcbiAgICAnY2cnLFxuICAgICdjaCcsXG4gICAgJ2NpJyxcbiAgICAnY2snLFxuICAgICdjbCcsXG4gICAgJ2NtJyxcbiAgICAnY24nLFxuICAgICdjbycsXG4gICAgJ2NvbScsXG4gICAgJ2Nvb3AnLFxuICAgICdjcicsXG4gICAgJ2N1JyxcbiAgICAnY3YnLFxuICAgICdjdycsXG4gICAgJ2N4JyxcbiAgICAnY3knLFxuICAgICdjeicsXG4gICAgJ2RlJyxcbiAgICAnZGonLFxuICAgICdkaycsXG4gICAgJ2RtJyxcbiAgICAnZG8nLFxuICAgICdkeicsXG4gICAgJ2VjJyxcbiAgICAnZWR1JyxcbiAgICAnZWUnLFxuICAgICdlZycsXG4gICAgJ2VyJyxcbiAgICAnZXMnLFxuICAgICdldCcsXG4gICAgJ2V1JyxcbiAgICAnZmknLFxuICAgICdmaicsXG4gICAgJ2ZrJyxcbiAgICAnZm0nLFxuICAgICdmbycsXG4gICAgJ2ZyJyxcbiAgICAnZ2EnLFxuICAgICdnYicsXG4gICAgJ2dkJyxcbiAgICAnZ2UnLFxuICAgICdnZicsXG4gICAgJ2dnJyxcbiAgICAnZ2gnLFxuICAgICdnaScsXG4gICAgJ2dsJyxcbiAgICAnZ20nLFxuICAgICdnbicsXG4gICAgJ2dvdicsXG4gICAgJ2dwJyxcbiAgICAnZ3EnLFxuICAgICdncicsXG4gICAgJ2dzJyxcbiAgICAnZ3QnLFxuICAgICdndScsXG4gICAgJ2d3JyxcbiAgICAnZ3knLFxuICAgICdoaycsXG4gICAgJ2htJyxcbiAgICAnaG4nLFxuICAgICdocicsXG4gICAgJ2h0JyxcbiAgICAnaHUnLFxuICAgICdpZCcsXG4gICAgJ2llJyxcbiAgICAnaWwnLFxuICAgICdpbScsXG4gICAgJ2luJyxcbiAgICAnaW5mbycsXG4gICAgJ2ludCcsXG4gICAgJ2lvJyxcbiAgICAnaXEnLFxuICAgICdpcicsXG4gICAgJ2lzJyxcbiAgICAnaXQnLFxuICAgICdqZScsXG4gICAgJ2ptJyxcbiAgICAnam8nLFxuICAgICdqb2JzJyxcbiAgICAnanAnLFxuICAgICdrZScsXG4gICAgJ2tnJyxcbiAgICAna2gnLFxuICAgICdraScsXG4gICAgJ2ttJyxcbiAgICAna24nLFxuICAgICdrcCcsXG4gICAgJ2tyJyxcbiAgICAna3cnLFxuICAgICdreScsXG4gICAgJ2t6JyxcbiAgICAnbGEnLFxuICAgICdsYicsXG4gICAgJ2xjJyxcbiAgICAnbGknLFxuICAgICdsaycsXG4gICAgJ2xyJyxcbiAgICAnbHMnLFxuICAgICdsdCcsXG4gICAgJ2x1JyxcbiAgICAnbHYnLFxuICAgICdseScsXG4gICAgJ21hJyxcbiAgICAnbWMnLFxuICAgICdtZCcsXG4gICAgJ21lJyxcbiAgICAnbWYnLFxuICAgICdtZycsXG4gICAgJ21oJyxcbiAgICAnbWlsJyxcbiAgICAnbWsnLFxuICAgICdtbCcsXG4gICAgJ21tJyxcbiAgICAnbW4nLFxuICAgICdtbycsXG4gICAgJ21vYmknLFxuICAgICdtcCcsXG4gICAgJ21xJyxcbiAgICAnbXInLFxuICAgICdtcycsXG4gICAgJ210JyxcbiAgICAnbXUnLFxuICAgICdtdXNldW0nLFxuICAgICdtdicsXG4gICAgJ213JyxcbiAgICAnbXgnLFxuICAgICdteScsXG4gICAgJ216JyxcbiAgICAnbmEnLFxuICAgICduYW1lJyxcbiAgICAnbmMnLFxuICAgICduZScsXG4gICAgJ25ldCcsXG4gICAgJ25mJyxcbiAgICAnbmcnLFxuICAgICduaScsXG4gICAgJ25sJyxcbiAgICAnbm8nLFxuICAgICducCcsXG4gICAgJ25yJyxcbiAgICAnbnUnLFxuICAgICdueicsXG4gICAgJ29tJyxcbiAgICAnb3JnJyxcbiAgICAncGEnLFxuICAgICdwZScsXG4gICAgJ3BmJyxcbiAgICAncGcnLFxuICAgICdwaCcsXG4gICAgJ3BrJyxcbiAgICAncGwnLFxuICAgICdwbScsXG4gICAgJ3BuJyxcbiAgICAncHInLFxuICAgICdwcm8nLFxuICAgICdwcycsXG4gICAgJ3B0JyxcbiAgICAncHcnLFxuICAgICdweScsXG4gICAgJ3FhJyxcbiAgICAncmUnLFxuICAgICdybycsXG4gICAgJ3JzJyxcbiAgICAncnUnLFxuICAgICdydycsXG4gICAgJ3NhJyxcbiAgICAnc2InLFxuICAgICdzYycsXG4gICAgJ3NkJyxcbiAgICAnc2UnLFxuICAgICdzZycsXG4gICAgJ3NoJyxcbiAgICAnc2knLFxuICAgICdzaicsXG4gICAgJ3NrJyxcbiAgICAnc2wnLFxuICAgICdzbScsXG4gICAgJ3NuJyxcbiAgICAnc28nLFxuICAgICdzcicsXG4gICAgJ3N0JyxcbiAgICAnc3UnLFxuICAgICdzdicsXG4gICAgJ3N4JyxcbiAgICAnc3knLFxuICAgICdzeicsXG4gICAgJ3RjJyxcbiAgICAndGQnLFxuICAgICd0ZWwnLFxuICAgICd0ZicsXG4gICAgJ3RnJyxcbiAgICAndGgnLFxuICAgICd0aicsXG4gICAgJ3RrJyxcbiAgICAndGwnLFxuICAgICd0bScsXG4gICAgJ3RuJyxcbiAgICAndG8nLFxuICAgICd0cCcsXG4gICAgJ3RyJyxcbiAgICAndHJhdmVsJyxcbiAgICAndHQnLFxuICAgICd0dicsXG4gICAgJ3R3JyxcbiAgICAndHonLFxuICAgICd1YScsXG4gICAgJ3VnJyxcbiAgICAndWsnLFxuICAgICd1bScsXG4gICAgJ3VzJyxcbiAgICAndXknLFxuICAgICd1eicsXG4gICAgJ3ZhJyxcbiAgICAndmMnLFxuICAgICd2ZScsXG4gICAgJ3ZnJyxcbiAgICAndmknLFxuICAgICd2bicsXG4gICAgJ3Z1JyxcbiAgICAnd2YnLFxuICAgICd3cycsXG4gICAgJ1x1NEUyRFx1NTZGRCcsXG4gICAgJ1x1NEUyRFx1NTcwQicsXG4gICAgJ1x1MERCRFx1MEQ4Mlx1MEQ5QVx1MERDRicsXG4gICAgJ1x1OTk5OVx1NkUyRicsXG4gICAgJ1x1NTNGMFx1NkU3RScsXG4gICAgJ1x1NTNGMFx1NzA2MycsXG4gICAgJ1x1MDYyN1x1MDY0NVx1MDYyN1x1MDYzMVx1MDYyN1x1MDYyQScsXG4gICAgJ1x1MDYyN1x1MDY0NFx1MDYyN1x1MDYzMVx1MDYyRlx1MDY0NicsXG4gICAgJ1x1MDYyN1x1MDY0NFx1MDYzM1x1MDYzOVx1MDY0OFx1MDYyRlx1MDY0QVx1MDYyOScsXG4gICAgJ1x1MEU0NFx1MEUxN1x1MEUyMicsXG4gICAgJ1x1MDQ0MFx1MDQ0NCcsXG4gICAgJ1x1MDYyQVx1MDY0OFx1MDY0Nlx1MDYzMycsXG4gICAgJ1x1MDY0NVx1MDYzNVx1MDYzMScsXG4gICAgJ1x1MDY0Mlx1MDYzN1x1MDYzMScsXG4gICAgJ1x1MEI4N1x1MEJCMlx1MEI5OVx1MEJDRFx1MEI5NVx1MEJDOCcsXG4gICAgJ1x1MDY0MVx1MDY0NFx1MDYzM1x1MDYzN1x1MDY0QVx1MDY0NicsXG4gICAgJ3llJyxcbiAgICAneXQnLFxuICAgICd6YScsXG4gICAgJ3ptJyxcbiAgICAnencnLFxuICBdKTtcblxuZXhwb3J0IHR5cGUgUHJvcHMgPSB7XG4gIHRleHQ6IHN0cmluZztcbiAgLyoqIEFsbG93cyB5b3UgdG8gY3VzdG9taXplIGhvdyBub24tbGlua3MgYXJlIHJlbmRlcmVkLiBTaW1wbGVzdCBpcyBqdXN0IGEgPHNwYW4+LiAqL1xuICByZW5kZXJOb25MaW5rPzogUmVuZGVyVGV4dENhbGxiYWNrVHlwZTtcbn07XG5cbmNvbnN0IFNVUFBPUlRFRF9QUk9UT0NPTFMgPSAvXihodHRwfGh0dHBzKTovaTtcblxuZXhwb3J0IGNsYXNzIExpbmtpZnkgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHM+IHtcbiAgcHVibGljIHN0YXRpYyBkZWZhdWx0UHJvcHM6IFBhcnRpYWw8UHJvcHM+ID0ge1xuICAgIHJlbmRlck5vbkxpbms6ICh7IHRleHQgfSkgPT4gdGV4dCxcbiAgfTtcblxuICBwdWJsaWMgb3ZlcnJpZGUgcmVuZGVyKCk6XG4gICAgfCBKU1guRWxlbWVudFxuICAgIHwgc3RyaW5nXG4gICAgfCBudWxsXG4gICAgfCBBcnJheTxKU1guRWxlbWVudCB8IHN0cmluZyB8IG51bGw+IHtcbiAgICBjb25zdCB7IHRleHQsIHJlbmRlck5vbkxpbmsgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIXNob3VsZExpbmtpZnlNZXNzYWdlKHRleHQpKSB7XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG5cbiAgICAvLyBXZSBoYXZlIHRvIGRvIHRoaXMsIGJlY2F1c2UgcmVuZGVyTm9uTGluayBpcyBub3QgcmVxdWlyZWQgaW4gb3VyIFByb3BzIG9iamVjdCxcbiAgICAvLyAgYnV0IGl0IGlzIGFsd2F5cyBwcm92aWRlZCB2aWEgZGVmYXVsdFByb3BzLlxuICAgIGlmICghcmVuZGVyTm9uTGluaykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgY2h1bmtEYXRhOiBBcnJheTx7XG4gICAgICBjaHVuazogc3RyaW5nO1xuICAgICAgbWF0Y2hEYXRhOiBSZWFkb25seUFycmF5PExpbmtpZnlJdC5NYXRjaD47XG4gICAgfT4gPSBzcGxpdEJ5RW1vamkodGV4dCkubWFwKCh7IHR5cGUsIHZhbHVlOiBjaHVuayB9KSA9PiB7XG4gICAgICBpZiAodHlwZSA9PT0gJ3RleHQnKSB7XG4gICAgICAgIHJldHVybiB7IGNodW5rLCBtYXRjaERhdGE6IGxpbmtpZnkubWF0Y2goY2h1bmspIHx8IFtdIH07XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlID09PSAnZW1vamknKSB7XG4gICAgICAgIHJldHVybiB7IGNodW5rLCBtYXRjaERhdGE6IFtdIH07XG4gICAgICB9XG5cbiAgICAgIHRocm93IG1pc3NpbmdDYXNlRXJyb3IodHlwZSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHRzOiBBcnJheTxKU1guRWxlbWVudCB8IHN0cmluZz4gPSBbXTtcbiAgICBsZXQgY291bnQgPSAxO1xuXG4gICAgY2h1bmtEYXRhLmZvckVhY2goKHsgY2h1bmssIG1hdGNoRGF0YSB9KSA9PiB7XG4gICAgICBpZiAobWF0Y2hEYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICByZXN1bHRzLnB1c2gocmVuZGVyTm9uTGluayh7IHRleHQ6IGNodW5rLCBrZXk6IGNvdW50IH0pKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQgY2h1bmtMYXN0SW5kZXggPSAwO1xuICAgICAgbWF0Y2hEYXRhLmZvckVhY2gobWF0Y2ggPT4ge1xuICAgICAgICBpZiAoY2h1bmtMYXN0SW5kZXggPCBtYXRjaC5pbmRleCkge1xuICAgICAgICAgIGNvbnN0IHRleHRXaXRoTm9MaW5rID0gY2h1bmsuc2xpY2UoY2h1bmtMYXN0SW5kZXgsIG1hdGNoLmluZGV4KTtcbiAgICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICAgIHJlc3VsdHMucHVzaChyZW5kZXJOb25MaW5rKHsgdGV4dDogdGV4dFdpdGhOb0xpbmssIGtleTogY291bnQgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyB1cmwsIHRleHQ6IG9yaWdpbmFsVGV4dCB9ID0gbWF0Y2g7XG4gICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgIGlmIChTVVBQT1JURURfUFJPVE9DT0xTLnRlc3QodXJsKSAmJiAhaXNMaW5rU25lYWt5KHVybCkpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goXG4gICAgICAgICAgICA8YSBrZXk9e2NvdW50fSBocmVmPXt1cmx9PlxuICAgICAgICAgICAgICB7b3JpZ2luYWxUZXh0fVxuICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHJlbmRlck5vbkxpbmsoeyB0ZXh0OiBvcmlnaW5hbFRleHQsIGtleTogY291bnQgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2h1bmtMYXN0SW5kZXggPSBtYXRjaC5sYXN0SW5kZXg7XG4gICAgICB9KTtcblxuICAgICAgaWYgKGNodW5rTGFzdEluZGV4IDwgY2h1bmsubGVuZ3RoKSB7XG4gICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgIHJlc3VsdHMucHVzaChcbiAgICAgICAgICByZW5kZXJOb25MaW5rKHtcbiAgICAgICAgICAgIHRleHQ6IGNodW5rLnNsaWNlKGNodW5rTGFzdEluZGV4KSxcbiAgICAgICAgICAgIGtleTogY291bnQsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0EsbUJBQWtCO0FBRWxCLHdCQUFzQjtBQUd0Qix5QkFBbUQ7QUFDbkQsbUJBQTZCO0FBQzdCLDhCQUFpQztBQUVqQyxNQUFNLFVBQVUsK0JBQVUsRUFVdkIsS0FBSztBQUFBLEVBQ0o7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxF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
